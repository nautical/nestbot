# Description:
# Stores user history of commands
#
# Dependencies:
# None
#
# Commands:
# hubot clear history - Clears the user history
# hubot last command - Retreives the last command given by user
#
# Author:
# nautical

module.exports = (robot) ->

  options =
    lines_to_keep: process.env.HUBOT_USER_HISTORY_LINES

  unless options.lines_to_keep
    options.lines_to_keep = 5

  robot.hear /(.*)/i, (msg) ->
    userhistory = []
    userhistory = msg.message.user.historychat
    if userhistory == undefined
        userhistory = []
    if userhistory.length < 5
        userhistory.push msg.match[1]
        msg.message.user.historychat = userhistory
        robot.brain.data.users[msg.message.user.id] = msg.message.user
    else
        userhistory.shift()
        userhistory.push msg.match[1]
        msg.message.user.historychat = userhistory
        robot.brain.data.users[msg.message.user.id] = msg.message.user

  robot.respond /clear history/i, (msg) ->
    msg.send "Ok, I'm clearing your history."
    userhistory = []
    msg.message.user.historychat = userhistory
    robot.brain.data.users[msg.message.user.id] = msg.message.user

  robot.respond /last command/i, (msg) ->
    msg.send msg.message.user.historychat[msg.message.user.historychat.length-2] # not -1 , it will return "last command" only